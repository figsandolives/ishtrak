<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
        .modal { 
            display: none !important; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø· */
        .modal.show { 
            display: flex !important; 
            align-items: center;
            justify-content: center;
        }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .subscription-card:hover { transform: translateY(-2px); transition: all 0.3s ease; }
        .price-option { transition: all 0.2s ease; }
        .price-option:hover { background-color: #f0f9ff; }
        .day-checkbox { transition: all 0.2s ease; }
        .day-checkbox:hover { background-color: #f3f4f6; }
        .image-preview { max-width: 300px; max-height: 200px; object-fit: contain; }
        .subscription-image { cursor: pointer; transition: transform 0.2s ease; }
        .subscription-image:hover { transform: scale(1.05); }
        
        /* ØªØµÙ…ÙŠÙ… Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ */
        .signature-pad {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            cursor: crosshair;
            background: #fafafa;
        }
        
        .signature-pad.signed {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            body * { visibility: hidden; }
            .print-content, .print-content * { visibility: visible; }
            .print-content { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
        }
        
        .print-page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            page-break-after: always;
        }
        
        .print-page:last-child {
            page-break-after: auto;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainPage" class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸƒ Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
            <p class="text-gray-600 text-lg">Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</p>
        </div>

        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h2>
                    <button onclick="openNewSubscriptionForm()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        â• Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </div>
                
                <div id="subscriptionsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ù‡Ù†Ø§ -->
                    <div class="text-center py-12 col-span-full">
                        <div class="text-6xl mb-4">ğŸ“‹</div>
                        <p class="text-gray-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <div id="newSubscriptionModal" class="modal">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto m-4" onclick="event.stopPropagation()">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">ğŸ“ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯Ø©</h2>
                    <button type="button" onclick="closeModal('newSubscriptionModal')" class="text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center text-xl transition-colors">âœ•</button>
                </div>
            </div>

            <form id="subscriptionForm" class="p-6 space-y-6">
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
                <div class="bg-blue-50 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-blue-800 mb-4">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† *</label>
                            <input type="text" id="customerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                            <input type="text" id="phoneNumber" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ù…Ø«Ø§Ù„: Ù©Ù¦Ù¥Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨" oninput="convertArabicToEnglish(this)">
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
                <div class="bg-green-50 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-green-800 mb-4">ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h3>
                    <div class="flex gap-4 mb-4">
                        <button type="button" onclick="selectAddressType('house')" id="houseBtn" class="flex-1 py-3 px-6 border-2 border-green-300 rounded-lg font-medium transition-all duration-200 hover:bg-green-100">ğŸ  Ø¨ÙŠØª</button>
                        <button type="button" onclick="selectAddressType('apartment')" id="apartmentBtn" class="flex-1 py-3 px-6 border-2 border-gray-300 rounded-lg font-medium transition-all duration-200 hover:bg-gray-100">ğŸ¢ Ø´Ù‚Ø©</button>
                    </div>

                    <div id="addressFields" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‡Ù†Ø§ -->
                    </div>
                </div>

                <!-- Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
                <div class="bg-purple-50 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-purple-800 mb-4">ğŸ“‹ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                    <div class="grid grid-cols-1 gap-4 max-h-96 overflow-y-auto">
                        <div id="subscriptionTypes"></div>
                    </div>
                </div>

                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
                <div id="subscriptionDetails" class="bg-orange-50 rounded-xl p-6 hidden">
                    <h3 class="text-xl font-semibold text-orange-800 mb-4">â° ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ *</label>
                            <input type="date" id="startDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" onchange="calculateEndDate()">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„ *</label>
                            <select id="deliveryTime" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                <option value="">Ø§Ø®ØªØ± ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„</option>
                                <option value="9-12">Ù…Ù† Ù©Øµ Ø§Ù„Ù‰ Ù¡Ù¢Ø¸</option>
                                <option value="12-15">Ù…Ù† Ù¡Ù¢Ø¸ Ø§Ù„Ù‰ Ù£Ù…</option>
                                <option value="15-18">Ù…Ù† Ù£Ù… Ø§Ù„Ù‰ Ù¦Ù…</option>
                                <option value="18-21">Ù…Ù† Ù¦Ù… Ø§Ù„Ù‰ Ù©Ù…</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø© Ù…Ù† Ø§Ù„ØªÙˆØµÙŠÙ„</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2" id="weekDays">
                            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø¯.Ùƒ)</label>
                            <input type="number" id="deliveryPrice" step="0.1" min="0" value="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" onchange="updateTotalPrice()">
                            <div id="freeDeliveryNote" class="text-sm text-green-600 mt-1 hidden">âœ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ</div>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-4">
                            <div class="text-sm text-gray-600 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:</div>
                            <div class="space-y-1">
                                <div class="flex justify-between"><span>Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</span><span id="subscriptionPriceDisplay">0 Ø¯.Ùƒ</span></div>
                                <div class="flex justify-between"><span>Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„:</span><span id="deliveryPriceDisplay">0 Ø¯.Ùƒ</span></div>
                                <div class="flex justify-between font-bold border-t pt-1"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="totalPriceDisplay">0 Ø¯.Ùƒ</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 p-4 bg-blue-100 rounded-lg" id="datesSummary" style="display: none;">
                        <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù‡Ù†Ø§ -->
                    </div>
                </div>



                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <div class="flex gap-4 pt-6 border-t border-gray-200">
                    <button type="button" onclick="closeModal('newSubscriptionModal')" class="flex-1 py-3 px-6 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" id="submitBtn" class="flex-1 py-3 px-6 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl">âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ -->
    <div id="confirmationModal" class="modal">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full m-4 p-8 text-center" onclick="event.stopPropagation()">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ…</h2>
            <p class="text-gray-600 mb-6">ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„Ø¯ÙØ¹</p>
            <button onclick="closeModal('confirmationModal')" class="w-full py-3 px-6 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:from-green-600 hover:to-green-700 transition-all duration-300">
                Ø­Ø³Ù†Ø§Ù‹
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© -->
    <div id="imageModal" class="modal">
        <div class="relative" onclick="event.stopPropagation()">
            <img id="modalImage" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" class="rounded-lg shadow-2xl max-w-[90vw] max-h-[90vh] object-contain">
            <button type="button" onclick="closeModal('imageModal')" class="absolute top-4 right-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-full w-10 h-10 flex items-center justify-center text-xl transition-all">âœ•</button>
        </div>
    </div>



    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© -->
    <div id="printArea" class="print-content hidden">
        <!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù‡Ù†Ø§ -->
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBIP8ezD990c7kZ3z-gsma2KJpp7Zqu7eA",
            authDomain: "ishtrakta.firebaseapp.com",
            databaseURL: "https://ishtrakta-default-rtdb.firebaseio.com",
            projectId: "ishtrakta",
            storageBucket: "ishtrakta.firebasestorage.app",
            messagingSenderId: "854766859254",
            appId: "1:854766859254:web:0375c2c8c9c518b2f74dd7",
            measurementId: "G-QT71DGNRXT"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
        const subscriptionTypes = [
            { id: 1, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ø¨Ø§ØªÙŠ", prices: { week: 87.5, twoWeeks: 120, month: 240 }, image: "a1.jpg" },
            { id: 2, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„ÙˆØ²Ù†", prices: { week: 93.5, twoWeeks: 130, month: 250 }, image: "a2.jpg" },
            { id: 3, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø®Ø§Øµ Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù†Ø§Ø¹Ø©", prices: { week: 95, twoWeeks: 145, month: 280 }, image: "a3.jpg" },
            { id: 4, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙŠØªÙˆ", prices: { week: 95, twoWeeks: 140, month: 280 }, image: "a4.jpg" },
            { id: 5, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø®Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø¬Ù„ÙˆØªÙŠÙ†", prices: { week: 93.5, twoWeeks: 130, month: 260 }, image: "a5.jpg" },
            { id: 6, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø®Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø¬Ù„ÙˆØªÙŠÙ† ÙˆÙ…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ù„Ø¨Ø§Ù†", prices: { week: 91.5, twoWeeks: 128.5, month: 255 }, image: "a6.jpg" },
            { id: 7, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„Ø§Ù„ØªÙ‡Ø§Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø³Ù… Ø¨Ø§Ù„ØµÙŠØ§Ù… Ø§Ù„Ù…ØªÙ‚Ø·Ø¹", prices: { tenDays: 120, twentyDays: 200, thirtyDays: 290 }, image: "a7.jpg", note: "Ù…Ø¹ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ØªÙ„Ù‚Ø±Ø§Ù… Ø§Ù„Ø°ÙŠ Ù‚ÙŠÙ…ØªÙ‡ Ù¥Ù  Ø¯ÙŠÙ†Ø§Ø± Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø± ÙÙ‚Ø·" },
            { id: 8, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„Ø¥Ù„ØªÙ‡Ø§Ø¨Ø§Øª Ø¨Ø¯ÙˆÙ† ØµÙŠØ§Ù…", prices: { tenDays: 130, twentyDays: 210, thirtyDays: 300 }, image: "a8.jpg", note: "Ù…Ø¹ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ØªÙ„Ù‚Ø±Ø§Ù… Ø§Ù„Ø°ÙŠ Ù‚ÙŠÙ…ØªÙ‡ Ù¥Ù  Ø¯ÙŠÙ†Ø§Ø± Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø± ÙÙ‚Ø·" },
            { id: 9, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø±Ù…Ø¶Ø§Ù†", prices: { week: 90, twoWeeks: 140, month: 240 }, image: "a9.jpg" },
            { id: 10, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù†Ø¨Ø§ØªÙŠ", prices: { week: 80, twoWeeks: 130, month: 230 }, image: "a10.jpg" },
            { id: 11, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø±ÙØ¹ Ù†Ø³Ø¨ Ø§Ù…ØªØµØ§Øµ Ø§Ù„ÙÙŠØªØ§Ù…ÙŠÙ†ØªØŒ ÙˆØ§Ù„Ù…Ø¹Ø§Ø¯Ù† (ÙŠØµÙ„Ø­ Ù„Ù„Ù†Ø³Ø§Ø¡ Ø§Ù„Ø­Ø§Ù…Ù„)", prices: { week: 93.5, twoWeeks: 130, month: 250 }, image: "a11.jpg" },
            { id: 12, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø®Ø§Øµ Ù„Ù„Ù†Ø³Ø§Ø¡ Ø§Ù„Ù…Ø±Ø¶Ø¹Ø§Øª", prices: { week: 93.5, twoWeeks: 130, month: 260 }, image: "a12.jpg" },
            { id: 13, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø¶Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©", prices: { week: 96.5, twoWeeks: 133.5, month: 260 }, image: "a13.jpg" },
            { id: 14, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø®Ø§Øµ Ù„Ù„Ø±ÙŠØ§Ø¶ÙŠÙŠÙ†", prices: { tenDays: 120, twentyDays: 180, thirtyDays: 230 }, image: "a14.jpg" },
            { id: 15, name: "Ø§Ø³Ù„ÙˆØ¨ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„ØµØ­ÙŠØ© (ØºÙŠØ± Ù…Ø®ØµØµ Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙˆØ²Ù†)", prices: { tenDays: 120, twentyDays: 180, thirtyDays: 230 }, image: "a15.jpg" },
            { id: 16, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠØ© Ø±ÙŠÙ… Ø§Ù„Ø¹Ù†Ø²ÙŠØŒ Ù…Ø­Ø³ÙˆØ¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª", prices: { tenDays: 150, twentyDays: 200, thirtyDays: 230 }, image: "a16.jpg" },
            { id: 17, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ø±ÙŠÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰", prices: { week: 50, twoWeeks: 80, month: 120 }, image: "a17.jpg" },
            { id: 18, name: "Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø®ØµØµ", prices: { custom: true }, image: null, isCustom: true }
        ];

        let selectedSubscription = null;
        let selectedPeriod = null;
        let selectedPrice = 0;
        let addressType = null;
        let excludedDays = [];
        let signaturePad = null;
        let isSignatureSigned = false;
        let currentSubscriptionData = null;

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
        function convertArabicToEnglish(input) {
            const arabicNumbers = 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©';
            const englishNumbers = '0123456789';
            let value = input.value;
            
            for (let i = 0; i < arabicNumbers.length; i++) {
                value = value.replace(new RegExp(arabicNumbers[i], 'g'), englishNumbers[i]);
            }
            
            input.value = value;
        }

        // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
        function openModal(modalId) {
            // Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø£ÙˆÙ„Ø§Ù‹
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
            
            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            setTimeout(() => {
                document.getElementById(modalId).classList.add('show');
            }, 100);
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            
            if (modalId === 'newSubscriptionModal') {
                resetForm();
            }
        }

        // ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        function openNewSubscriptionForm() {
            openModal('newSubscriptionModal');
            initializeSubscriptionTypes();
            initializeWeekDays();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function resetForm() {
            selectedSubscription = null;
            selectedPeriod = null;
            selectedPrice = 0;
            addressType = null;
            excludedDays = [];
            
            document.getElementById('subscriptionForm').reset();
            document.getElementById('subscriptionDetails').classList.add('hidden');
            document.getElementById('addressFields').innerHTML = '';
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        function selectAddressType(type) {
            addressType = type;
            document.getElementById('houseBtn').className = type === 'house' ? 
                'flex-1 py-3 px-6 border-2 border-green-500 bg-green-100 rounded-lg font-medium transition-all duration-200' :
                'flex-1 py-3 px-6 border-2 border-gray-300 rounded-lg font-medium transition-all duration-200 hover:bg-gray-100';
            
            document.getElementById('apartmentBtn').className = type === 'apartment' ? 
                'flex-1 py-3 px-6 border-2 border-green-500 bg-green-100 rounded-lg font-medium transition-all duration-200' :
                'flex-1 py-3 px-6 border-2 border-gray-300 rounded-lg font-medium transition-all duration-200 hover:bg-gray-100';
            
            generateAddressFields(type);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        function generateAddressFields(type) {
            const addressFields = document.getElementById('addressFields');
            
            if (type === 'house') {
                addressFields.innerHTML = `
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label><input type="text" id="area" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù‚Ø·Ø¹Ø© *</label><input type="text" id="block" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ø§Ø±Ø¹ *</label><input type="text" id="street" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¬Ø§Ø¯Ø© (Ø¥Ù† ÙˆØ¬Ø¯Øª)</label><input type="text" id="avenue" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„ *</label><input type="text" id="houseNumber" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø¨Ù†Ù‰ Ù…Ø¬Ø§ÙˆØ±ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="text" id="nearbyBuilding" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                `;
            } else if (type === 'apartment') {
                addressFields.innerHTML = `
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label><input type="text" id="area" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù‚Ø·Ø¹Ø© *</label><input type="text" id="block" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ø§Ø±Ø¹ *</label><input type="text" id="street" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¬Ø§Ø¯Ø© (Ø¥Ù† ÙˆØ¬Ø¯Øª)</label><input type="text" id="avenue" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù…/Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø§ÙŠØ© *</label><input type="text" id="buildingName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø·Ø§Ø¨Ù‚ *</label><input type="text" id="floor" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ù‚Ø© *</label><input type="text" id="apartment" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø¨Ù†Ù‰ Ù…Ø¬Ø§ÙˆØ±ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="text" id="nearbyBuilding" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></div>
                `;
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
        function initializeSubscriptionTypes() {
            const container = document.getElementById('subscriptionTypes');
            container.innerHTML = '';
            
            subscriptionTypes.forEach(subscription => {
                const div = document.createElement('div');
                div.className = 'subscription-card border-2 border-gray-200 rounded-xl p-4 cursor-pointer transition-all duration-200 hover:shadow-lg';
                div.onclick = () => selectSubscription(subscription);
                
                let pricesHtml = '';
                if (subscription.isCustom) {
                    pricesHtml = '<div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>';
                } else {
                    const prices = subscription.prices;
                    if (prices.week) {
                        pricesHtml += `<div class="text-sm text-gray-600">Ø£Ø³Ø¨ÙˆØ¹: ${prices.week} Ø¯.Ùƒ | Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†: ${prices.twoWeeks} Ø¯.Ùƒ | Ø´Ù‡Ø±: ${prices.month} Ø¯.Ùƒ</div>`;
                    } else {
                        pricesHtml += `<div class="text-sm text-gray-600">Ù¡Ù  Ø£ÙŠØ§Ù…: ${prices.tenDays} Ø¯.Ùƒ | Ù¢Ù  ÙŠÙˆÙ…: ${prices.twentyDays} Ø¯.Ùƒ | Ù£Ù  ÙŠÙˆÙ…: ${prices.thirtyDays} Ø¯.Ùƒ</div>`;
                    }
                }
                
                div.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 mb-2">${subscription.name}</h4>
                            ${pricesHtml}
                            ${subscription.note ? `<div class="text-xs text-blue-600 mt-1">${subscription.note}</div>` : ''}
                        </div>
                        ${subscription.image ? `<img src="${subscription.image}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" class="subscription-image w-16 h-16 object-cover rounded-lg" onclick="event.stopPropagation(); showImage('${subscription.image}')">` : ''}
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        function selectSubscription(subscription) {
            selectedSubscription = subscription;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ…ÙŠÙ…
            document.querySelectorAll('.subscription-card').forEach(card => {
                card.className = 'subscription-card border-2 border-gray-200 rounded-xl p-4 cursor-pointer transition-all duration-200 hover:shadow-lg';
            });
            event.currentTarget.className = 'subscription-card border-2 border-purple-500 bg-purple-50 rounded-xl p-4 cursor-pointer transition-all duration-200 shadow-lg';
            
            // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØªØ±Ø©
            showPeriodOptions(subscription);
        }

        // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØªØ±Ø©
        function showPeriodOptions(subscription) {
            const detailsDiv = document.getElementById('subscriptionDetails');
            detailsDiv.classList.remove('hidden');
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† div Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯
            let periodContainer = detailsDiv.querySelector('.period-options-container');
            if (!periodContainer) {
                periodContainer = document.createElement('div');
                periodContainer.className = 'period-options-container';
                const firstChild = detailsDiv.querySelector('h3').nextElementSibling;
                firstChild.insertBefore(periodContainer, firstChild.firstChild);
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØªØ±Ø©
            let periodOptionsHtml = '<div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-3">Ø§Ø®ØªØ± ÙØªØ±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ *</label><div class="grid grid-cols-1 md:grid-cols-3 gap-3">';
            
            if (subscription.isCustom) {
                periodOptionsHtml += `
                    <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('week', 0)">
                        <div class="font-semibold">Ø£Ø³Ø¨ÙˆØ¹</div>
                        <div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>
                    </div>
                    <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('twoWeeks', 0)">
                        <div class="font-semibold">Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</div>
                        <div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>
                    </div>
                    <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('fourWeeks', 0)">
                        <div class="font-semibold">Ù¤ Ø£Ø³Ø§Ø¨ÙŠØ¹</div>
                        <div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>
                    </div>
                    <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('tenDays', 0)">
                        <div class="font-semibold">Ù¡Ù  Ø£ÙŠØ§Ù…</div>
                        <div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>
                    </div>
                    <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('twentyDays', 0)">
                        <div class="font-semibold">Ù¢Ù  ÙŠÙˆÙ…</div>
                        <div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>
                    </div>
                    <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('thirtyDays', 0)">
                        <div class="font-semibold">Ù£Ù  ÙŠÙˆÙ…</div>
                        <div class="text-sm text-gray-600">Ø³Ø¹Ø± Ù…Ø®ØµØµ</div>
                    </div>
                `;
                periodOptionsHtml += '</div></div>';
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø®ØµØµ
                periodOptionsHtml += `
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ØµØµ (Ø¯.Ùƒ) *</label>
                        <input type="number" id="customPrice" step="0.1" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" onchange="updateCustomPrice()">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ *</label>
                        <input type="file" id="customImage" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" onchange="previewCustomImage()">
                        <div id="imagePreview" class="mt-2"></div>
                    </div>
                `;
            } else {
                const prices = subscription.prices;
                if (prices.week) {
                    periodOptionsHtml += `
                        <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('week', ${prices.week})">
                            <div class="font-semibold">Ø£Ø³Ø¨ÙˆØ¹</div>
                            <div class="text-sm text-gray-600">${prices.week} Ø¯.Ùƒ</div>
                        </div>
                        <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('twoWeeks', ${prices.twoWeeks})">
                            <div class="font-semibold">Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</div>
                            <div class="text-sm text-gray-600">${prices.twoWeeks} Ø¯.Ùƒ</div>
                        </div>
                        <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('month', ${prices.month})">
                            <div class="font-semibold">Ø´Ù‡Ø±</div>
                            <div class="text-sm text-gray-600">${prices.month} Ø¯.Ùƒ</div>
                        </div>
                    `;
                } else {
                    periodOptionsHtml += `
                        <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('tenDays', ${prices.tenDays})">
                            <div class="font-semibold">Ù¡Ù  Ø£ÙŠØ§Ù…</div>
                            <div class="text-sm text-gray-600">${prices.tenDays} Ø¯.Ùƒ</div>
                        </div>
                        <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('twentyDays', ${prices.twentyDays})">
                            <div class="font-semibold">Ù¢Ù  ÙŠÙˆÙ…</div>
                            <div class="text-sm text-gray-600">${prices.twentyDays} Ø¯.Ùƒ</div>
                        </div>
                        <div class="price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center" onclick="selectPeriod('thirtyDays', ${prices.thirtyDays})">
                            <div class="font-semibold">Ù£Ù  ÙŠÙˆÙ…</div>
                            <div class="text-sm text-gray-600">${prices.thirtyDays} Ø¯.Ùƒ</div>
                        </div>
                    `;
                }
                periodOptionsHtml += '</div></div>';
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
            periodContainer.innerHTML = periodOptionsHtml;
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
        function selectPeriod(period, price) {
            selectedPeriod = period;
            selectedPrice = price;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ…ÙŠÙ…
            document.querySelectorAll('.price-option').forEach(option => {
                option.className = 'price-option border-2 border-gray-300 rounded-lg p-3 cursor-pointer text-center';
            });
            event.currentTarget.className = 'price-option border-2 border-orange-500 bg-orange-50 rounded-lg p-3 cursor-pointer text-center';
            
            updateTotalPrice();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ØµØµ
        function updateCustomPrice() {
            const customPrice = parseFloat(document.getElementById('customPrice').value) || 0;
            selectedPrice = customPrice;
            updateTotalPrice();
        }

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø®ØµØµØ©
        function previewCustomImage() {
            const file = document.getElementById('customImage').files[0];
            const preview = document.getElementById('imagePreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" class="image-preview rounded-lg border">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
        function initializeWeekDays() {
            const weekDays = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];
            const container = document.getElementById('weekDays');
            container.innerHTML = '';
            
            weekDays.forEach((day, index) => {
                const div = document.createElement('div');
                div.className = 'day-checkbox flex items-center p-2 border border-gray-300 rounded-lg cursor-pointer';
                div.onclick = () => toggleDay(index, div);
                div.innerHTML = `
                    <input type="checkbox" id="day${index}" checked class="mr-2">
                    <label for="day${index}" class="text-sm cursor-pointer">${day}</label>
                `;
                container.appendChild(div);
            });
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…
        function toggleDay(dayIndex, element) {
            const checkbox = element.querySelector('input');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                excludedDays = excludedDays.filter(day => day !== dayIndex);
                element.className = 'day-checkbox flex items-center p-2 border border-gray-300 rounded-lg cursor-pointer';
            } else {
                excludedDays.push(dayIndex);
                element.className = 'day-checkbox flex items-center p-2 border border-red-300 bg-red-50 rounded-lg cursor-pointer';
            }
            
            calculateEndDate();
        }

        // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
        function calculateEndDate() {
            const startDateInput = document.getElementById('startDate');
            if (!startDateInput.value || !selectedPeriod) return;
            
            const startDate = new Date(startDateInput.value);
            let duration = 0;
            
            switch (selectedPeriod) {
                case 'week': duration = 7; break;
                case 'twoWeeks': duration = 14; break;
                case 'fourWeeks': duration = 28; break;
                case 'tenDays': duration = 10; break;
                case 'twentyDays': duration = 20; break;
                case 'thirtyDays': duration = 30; break;
                case 'month': duration = 28; break;
                case 'custom': 
                    const customDuration = prompt('ÙƒÙ… ÙŠÙˆÙ… Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø®ØµØµØŸ');
                    duration = parseInt(customDuration) || 0; 
                    break;
            }
            
            if (duration === 0) return;
            
            let currentDate = new Date(startDate);
            let deliveryDays = 0;
            
            while (deliveryDays < duration) {
                if (!excludedDays.includes(currentDate.getDay())) {
                    deliveryDays++;
                }
                if (deliveryDays < duration) {
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            }
            
            const endDate = currentDate;
            
            // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
            const summary = document.getElementById('datesSummary');
            summary.style.display = 'block';
            summary.innerHTML = `
                <div class="font-semibold text-blue-800 mb-2">ğŸ“… Ù…Ù„Ø®Øµ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®:</div>
                <div class="space-y-1 text-sm">
                    <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</strong> ${startDate.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', calendar: 'gregory' })}</div>
                    <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong> ${endDate.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', calendar: 'gregory' })}</div>
                    <div><strong>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${duration} ÙŠÙˆÙ…</div>
                    ${excludedDays.length > 0 ? `<div><strong>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø©:</strong> ${excludedDays.map(day => ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'][day]).join(', ')}</div>` : ''}
                </div>
            `;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        function updateTotalPrice() {
            const deliveryPrice = parseFloat(document.getElementById('deliveryPrice').value) || 0;
            const totalPrice = selectedPrice + deliveryPrice;
            
            document.getElementById('subscriptionPriceDisplay').textContent = selectedPrice + ' Ø¯.Ùƒ';
            document.getElementById('deliveryPriceDisplay').textContent = deliveryPrice + ' Ø¯.Ùƒ';
            document.getElementById('totalPriceDisplay').textContent = totalPrice + ' Ø¯.Ùƒ';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
            const freeDeliveryNote = document.getElementById('freeDeliveryNote');
            if (deliveryPrice === 0) {
                freeDeliveryNote.classList.remove('hidden');
            } else {
                freeDeliveryNote.classList.add('hidden');
            }
        }



        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
        function showImage(imageSrc) {
            document.getElementById('modalImage').src = imageSrc;
            openModal('imageModal');
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('subscriptionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!selectedSubscription || !selectedPeriod || !addressType) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const formData = {
                customerName: document.getElementById('customerName').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                addressType: addressType,
                address: getAddressData(),
                subscription: selectedSubscription,
                period: selectedPeriod,
                price: selectedPrice,
                startDate: document.getElementById('startDate').value,
                deliveryTime: document.getElementById('deliveryTime').value,
                excludedDays: excludedDays,
                deliveryPrice: parseFloat(document.getElementById('deliveryPrice').value) || 0,
                totalPrice: selectedPrice + (parseFloat(document.getElementById('deliveryPrice').value) || 0),
                createdAt: new Date(),
                status: 'pending'
            };
            
            try {
                // Ø­ÙØ¸ ÙÙŠ Firebase
                const docRef = await db.collection('subscriptions').add(formData);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ù…ÙŠÙ„ - Ø±Ø§Ø¨Ø· ÙƒØ§Ù…Ù„ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
                const customerLink = `https://figsandolives.github.io/ishtrak/sign.html?customer=${docRef.id}`;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                const whatsappMessage = `ØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­ØŒ
ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹:
${customerLink}`;
                
                // ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                const cleanPhone = formData.phoneNumber.replace(/[^\d]/g, '');
                const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(whatsappMessage)}`;
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                closeModal('newSubscriptionModal');
                
                // ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                window.open(whatsappUrl, '_blank');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø¹Ù…ÙŠÙ„.');
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª
                loadSubscriptions();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        });



        // ØªØ­ÙˆÙŠÙ„ Data URL Ø¥Ù„Ù‰ Blob
        function dataURLtoBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        function getAddressData() {
            const address = {
                area: document.getElementById('area').value,
                block: document.getElementById('block').value,
                street: document.getElementById('street').value,
                avenue: document.getElementById('avenue')?.value || '',
                nearbyBuilding: document.getElementById('nearbyBuilding')?.value || ''
            };
            
            if (addressType === 'house') {
                address.houseNumber = document.getElementById('houseNumber').value;
            } else {
                address.buildingName = document.getElementById('buildingName').value;
                address.floor = document.getElementById('floor').value;
                address.apartment = document.getElementById('apartment').value;
            }
            
            return address;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        async function loadSubscriptions() {
            try {
                const snapshot = await db.collection('subscriptions').orderBy('createdAt', 'desc').get();
                const subscriptionsList = document.getElementById('subscriptionsList');
                
                if (snapshot.empty) {
                    subscriptionsList.innerHTML = `
                        <div class="text-center py-12 col-span-full">
                            <div class="text-6xl mb-4">ğŸ“‹</div>
                            <p class="text-gray-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                        </div>
                    `;
                    return;
                }
                
                subscriptionsList.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = 'bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow';
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-semibold text-lg text-gray-800">${data.customerName}</h3>
                            <span class="px-3 py-1 text-xs font-medium rounded-full ${data.status === 'approved' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${data.status === 'approved' ? 'Ù…Ø¹ØªÙ…Ø¯' : 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            <div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${data.phoneNumber}</div>
                            <div><strong>Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</strong> ${data.subscription.name}</div>
                            <div><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> ${getPeriodText(data.period)}</div>
                            <div><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${data.totalPrice} Ø¯.Ùƒ</div>
                            <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</strong> ${new Date(data.startDate).toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', calendar: 'gregory' })}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="sendToCustomer('${doc.id}')" class="flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„</button>
                            <button onclick="editSubscription('${doc.id}')" class="flex-1 py-2 px-4 bg-yellow-500 text-white rounded-lg text-sm hover:bg-yellow-600 transition-colors">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button onclick="deleteSubscription('${doc.id}')" class="flex-1 py-2 px-4 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600 transition-colors">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            ${data.status === 'approved' ? `<button onclick="printSubscription('${doc.id}')" class="py-2 px-4 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-colors">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>` : ''}
                        </div>
                    `;
                    subscriptionsList.appendChild(div);
                });
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª:', error);
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„ - Ø±Ø§Ø¨Ø· ÙƒØ§Ù…Ù„
        function sendToCustomer(id) {
            const customerLink = `https://figsandolives.github.io/ishtrak/sign.html?customer=${id}`;
            
            // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
            navigator.clipboard.writeText(customerLink).then(() => {
                alert(`ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©:\n${customerLink}\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.`);
            }).catch(() => {
                alert(`Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ù…ÙŠÙ„:\n${customerLink}\n\nÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.`);
            });
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        function editSubscription(id) {
            // ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
            alert('ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        // Ø­Ø°Ù Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        async function deleteSubscription(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØŸ')) {
                try {
                    await db.collection('subscriptions').doc(id).delete();
                    loadSubscriptions();
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ');
                }
            }
        }

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        async function printSubscription(id) {
            try {
                const doc = await db.collection('subscriptions').doc(id).get();
                if (!doc.exists) {
                    alert('Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                const data = doc.data();
                generatePrintContent(data);
                
                // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø©
                setTimeout(() => {
                    window.print();
                }, 500);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ');
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        function generatePrintContent(data) {
            const printArea = document.getElementById('printArea');
            const subscriptionNumber = Math.floor(Math.random() * 10000) + 1000;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ù†Ø³Ø® Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            let copies = 1;
            if (data.period === 'twoWeeks' || data.period === 'twentyDays') {
                copies = 2;
            } else if (data.period === 'month' || data.period === 'thirtyDays' || data.period === 'fourWeeks') {
                copies = 3;
            }
            
            let printHTML = `
                <!-- ØµÙØ­Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© -->
                <div class="print-page">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold mb-2">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ø´ØªØ±Ø§Ùƒ</h1>
                        <p class="text-lg text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©: ${subscriptionNumber}</p>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
                        <div class="border border-gray-300 rounded-lg p-4">
                            <h3 class="text-xl font-semibold mb-4 text-blue-800">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div><strong>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> ${data.customerName}</div>
                                <div><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${data.phoneNumber}</div>
                            </div>
                        </div>
                        
                        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
                        <div class="border border-gray-300 rounded-lg p-4">
                            <h3 class="text-xl font-semibold mb-4 text-green-800">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${data.addressType === 'house' ? 'Ø¨ÙŠØª' : 'Ø´Ù‚Ø©'}</div>
                                <div><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${data.address.area}</div>
                                <div><strong>Ø§Ù„Ù‚Ø·Ø¹Ø©:</strong> ${data.address.block}</div>
                                <div><strong>Ø§Ù„Ø´Ø§Ø±Ø¹:</strong> ${data.address.street}</div>
                                ${data.address.avenue ? `<div><strong>Ø§Ù„Ø¬Ø§Ø¯Ø©:</strong> ${data.address.avenue}</div>` : ''}
                                ${data.addressType === 'house' ? 
                                    `<div><strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„:</strong> ${data.address.houseNumber}</div>` :
                                    `<div><strong>Ø§Ù„Ø¨Ù†Ø§ÙŠØ©:</strong> ${data.address.buildingName}</div>
                                     <div><strong>Ø§Ù„Ø·Ø§Ø¨Ù‚:</strong> ${data.address.floor}</div>
                                     <div><strong>Ø§Ù„Ø´Ù‚Ø©:</strong> ${data.address.apartment}</div>`
                                }
                                ${data.address.nearbyBuilding ? `<div><strong>Ù…Ø¨Ù†Ù‰ Ù…Ø¬Ø§ÙˆØ±:</strong> ${data.address.nearbyBuilding}</div>` : ''}
                            </div>
                        </div>
                        
                        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
                        <div class="border border-gray-300 rounded-lg p-4">
                            <h3 class="text-xl font-semibold mb-4 text-purple-800">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div><strong>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</strong> ${data.subscription.name}</div>
                                <div><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> ${getPeriodText(data.period)}</div>
                                <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</strong> ${new Date(data.startDate).toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', calendar: 'gregory' })}</div>
                                <div><strong>ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${data.deliveryTime}</div>
                                <div><strong>Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</strong> ${data.price} Ø¯.Ùƒ</div>
                                <div><strong>Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${data.deliveryPrice} Ø¯.Ùƒ</div>
                                <div><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${data.totalPrice} Ø¯.Ùƒ</div>
                                ${data.excludedDays.length > 0 ? `<div class="col-span-2"><strong>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø©:</strong> ${data.excludedDays.map(day => ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'][day]).join(', ')}</div>` : ''}
                            </div>
                        </div>
                        
                        <!-- Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… -->
                        <div class="border border-gray-300 rounded-lg p-4">
                            <h3 class="text-xl font-semibold mb-4 text-red-800">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</h3>
                            <div class="space-y-2 text-sm">
                                <div>â€¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„Ø§ ÙŠØ³ØªØ±Ø¯.</div>
                                <div>â€¢ Ø¥Ø°Ø§ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ø£ÙŠ Ø³Ø¨Ø¨ ÙƒØ§Ù† Ù…Ù† Ø·Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆÙŠØµØ¨Ø­ ÙƒÙˆØ¨ÙˆÙ† Ù…Ø´ØªØ±ÙŠØ§Øª Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù‡ Ù…Ù† Ù…Ø®Ø¨Ø² Ø§Ù„ØªÙŠÙ† ÙˆØ§Ù„Ø²ÙŠØªÙˆÙ† Ø£Ùˆ Ù…Ø·Ø¹Ù… Ø§Ù„ØªÙŠÙ† Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.</div>
                            </div>
                        </div>
                        
                        <!-- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ -->
                        <div class="border border-gray-300 rounded-lg p-4">
                            <h3 class="text-xl font-semibold mb-4">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                            ${data.signatureURL ? `<img src="${data.signatureURL}" alt="ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„" class="border border-gray-300 rounded max-h-32">` : '<div class="border border-gray-300 rounded h-32 flex items-center justify-center text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙ‚ÙŠØ¹</div>'}
                        </div>
                    </div>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ø³Ø® Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            for (let i = 0; i < copies; i++) {
                if (data.subscription.image) {
                    printHTML += `
                        <div class="print-page">
                            <div class="text-center mb-4">
                                <h2 class="text-2xl font-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ - Ù†Ø³Ø®Ø© ${i + 1}</h2>
                            </div>
                            <div class="flex justify-center">
                                <img src="${data.subscription.image}" alt="Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" class="max-w-full max-h-full object-contain">
                            </div>
                        </div>
                    `;
                }
            }
            
            printArea.innerHTML = printHTML;
            printArea.classList.remove('hidden');
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„ÙØªØ±Ø©
        function getPeriodText(period) {
            const periods = {
                'week': 'Ø£Ø³Ø¨ÙˆØ¹',
                'twoWeeks': 'Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†',
                'fourWeeks': 'Ù¤ Ø£Ø³Ø§Ø¨ÙŠØ¹',
                'month': 'Ø´Ù‡Ø±',
                'tenDays': 'Ù¡Ù  Ø£ÙŠØ§Ù…',
                'twentyDays': 'Ù¢Ù  ÙŠÙˆÙ…',
                'thirtyDays': 'Ù£Ù  ÙŠÙˆÙ…',
                'custom': 'Ù…Ø®ØµØµ'
            };
            return periods[period] || period;
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ù…ÙØªØ§Ø­ Ø§Ù„Ù‡Ø±ÙˆØ¨
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const activeModal = document.querySelector('.modal.show');
                if (activeModal) {
                    closeModal(activeModal.id);
                }
            }
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal') && event.target.classList.contains('show')) {
                closeModal(event.target.id);
            }
        });


        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', loadSubscriptions);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b7193530b87cd5',t:'MTc1NDU3MzExMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
